{"version":3,"sources":["main.js"],"names":["ajaxRequest","closeReq","bIsLoading","ajaxError","alert","ajaxLoad","fragment","target","close","xhr","readyState","status","res","responseText","doc","DOMParser","parseFromString","querySelector","oPageInfo","title","textContent","year","dataset","document","bUpdateURL","history","pushState","url","getElementById","appendChild","classList","add","scrollIntoView","behavior","createElement","addEventListener","e","stopPropagation","removeChild","remove","getPage","sPage","XMLHttpRequest","onload","onerror","open","send","requestPage","sURL","location","assign","processLink","this","contains","sAjaxClass","matches","href","init","nIdx","nLen","links","length","onclick","onpopstate","oEvent","state","window","attachEvent","stop","abort","rebuildLinks"],"mappings":"AAEA,IAAAA,YAAA,IAAA,WAEA,SAAAC,IACAC,GAAA,EASA,SAAAC,IACAC,MAAA,kBAGA,SAAAC,IACA,IAOAC,EAcAC,EAQAC,EA7BA,IAAAC,EAAAC,YACA,MAAAD,EAAAE,SAGAC,EAAAH,EAAAI,aAEAC,GADA,IAAAC,WACAC,gBAAAJ,EAAA,aACAN,EAAAQ,EAAAG,cAAA,QACAC,EAAAC,MAAAL,EAAAG,cAAA,SAAAG,YACAC,EAAAf,EAAAgB,QAAAD,KAGAE,SAAAJ,MAAAD,EAAAC,MAEAK,IAEAC,QAAAC,UAAAR,EAAAA,EAAAC,MAAAD,EAAAS,KACAH,GAAA,IAIAjB,EAAAgB,SAAAK,eAAA,SAAAP,EAAA,aACAQ,YAAAvB,GACAC,EAAAuB,UAAAC,IAAA,WAGAxB,EAAAyB,eAAA,CAAAC,SAAA,WAGAzB,EAAAe,SAAAW,cAAA,UACA3B,EAAAU,cAAA,UAAAY,YAAArB,GACAA,EAAAY,YAAA,IACAZ,EAAA2B,iBAAA,QAAA,SAAAC,GACAA,EAAAC,kBACA9B,EAAA+B,YAAAhC,GACAiB,SAAAN,cAAA,WAAAa,UAAAS,OAAA,aAMAtC,IAGA,SAAAuC,EAAAC,GACAvC,IACAO,EAAA,IAAAiC,eACAxC,GAAA,EACAO,EAAAkC,OAAAtC,EACAI,EAAAmC,QAAAzC,EACAsC,IAAAvB,EAAAS,IAAAc,GACAhC,EAAAoC,KAAA,MAAA3B,EAAAS,KAAA,GACAlB,EAAAqC,QAGA,SAAAC,EAAAC,GACAvB,QAAAC,WACAF,GAAA,EACAgB,EAAAQ,IAGAC,SAAAC,OAAAF,GAIA,SAAAG,IACA,OAAAC,KAAAtB,UAAAuB,SAAAC,KACAF,KAAAG,QAAA,aACAH,KAAAtB,UAAAC,IAAA,UACAgB,EAAAK,KAAAI,QAEA,GAKA,SAAAC,IACAvC,EAAAC,MAAAI,SAAAJ,MACA,IAAA,IAAAuC,EAAA,EAAAC,EAAApC,SAAAqC,MAAAC,OAAAH,EAAAC,EAAApC,SAAAqC,MAAAF,KAAAI,QAAAX,IAGA,IAKA1C,EALA6C,EAAA,aACApC,EAAA,CACAC,MAAA,KACAQ,IAAAsB,SAAAO,MAGAtD,GAAA,EACAsB,GAAA,EAEAuC,WAAA,SAAAC,GACAxC,GAAA,EACAN,EAAAC,MAAA6C,EAAAC,MAAA9C,MACAD,EAAAS,IAAAqC,EAAAC,MAAAtC,IACAa,KAGA0B,OAAA/B,iBAAAA,iBAAA,OAAAsB,GAAA,GAAAS,OAAAC,YAAAA,YAAA,SAAAV,GAAAd,OAAAc,EACAL,KAAAP,KAAAE,EACAK,KAAAgB,KA9GA,WACAlE,IACAO,EAAA4D,QACApE,MA4GAmD,KAAAkB,aAAAb","file":"all.min.js","sourcesContent":["\n\nvar ajaxRequest = new (function () {\n\n  function closeReq () {\n    bIsLoading = false;\n  }\n\n  function abortReq () {\n    if (!bIsLoading) { return; }\n    xhr.abort();\n    closeReq();\n  }\n\n  function ajaxError () {\n    alert(\"Unknown error.\");\n  }\n\n  function ajaxLoad(){\n    if (xhr.readyState === 4) {\n      if (xhr.status === 200) {\n        \n        // parse answwer\n        var res = xhr.responseText;\n        var parser = new DOMParser;\n        var doc = parser.parseFromString(res, \"text/html\")\n        var fragment = doc.querySelector('main');\n        oPageInfo.title = doc.querySelector('title').textContent;\n        var year = fragment.dataset.year;\n\n        //\n        document.title = oPageInfo.title;\n        \n        if (bUpdateURL) {\n          console.log(oPageInfo, oPageInfo.title, oPageInfo.url);\n          history.pushState(oPageInfo, oPageInfo.title, oPageInfo.url);\n          bUpdateURL = false;\n        }\n        \n        // append\n        var target = document.getElementById(\"annee-\" + year + \"-content\");\n        target.appendChild(fragment);\n        target.classList.add('visible');\n        \n        // scroll\n        target.scrollIntoView({ behavior: 'smooth' });\n\n        // close button\n        var close = document.createElement('button');\n        target.querySelector('header').appendChild(close);\n        close.textContent = \"Ã—\";\n        close.addEventListener('click', function(e){\n          e.stopPropagation();\n          target.removeChild(fragment);\n          document.querySelector('.opened').classList.remove('opened');\n        });\n      } else {\n        console.error(xhr.statusText);\n      }\n    }\n    closeReq();\n  }\n\n  function getPage (sPage) {\n    if (bIsLoading) { return; }\n    xhr = new XMLHttpRequest();\n    bIsLoading = true;\n    xhr.onload = ajaxLoad;\n    xhr.onerror = ajaxError;\n    if (sPage) { oPageInfo.url = sPage; }\n    xhr.open(\"get\", oPageInfo.url, true);\n    xhr.send();\n  }\n\n  function requestPage (sURL) {\n    if (history.pushState) {\n      bUpdateURL = true;\n      getPage(sURL);\n    } else {\n      /* Ajax navigation is not supported */\n      location.assign(sURL);\n    }\n  }\n\n  function processLink () {\n    if (this.classList.contains(sAjaxClass)) {\n      if(!this.matches('.opened')){\n        this.classList.add(\"opened\");\n        requestPage(this.href);\n      } \n      return false;\n    }\n    return true;\n  }\n\n  function init () {\n    oPageInfo.title = document.title;\n    for (var oLink, nIdx = 0, nLen = document.links.length; nIdx < nLen; document.links[nIdx++].onclick = processLink);\n  }\n\n  var sAjaxClass = \"event-link\",\n    oPageInfo = {\n      title: null,\n      url: location.href\n    },\n    xhr, \n    bIsLoading = false, \n    bUpdateURL = false;\n\n  onpopstate = function (oEvent) {\n    bUpdateURL = false;\n    oPageInfo.title = oEvent.state.title;\n    oPageInfo.url = oEvent.state.url;\n    getPage();\n  };\n\n  window.addEventListener ? addEventListener(\"load\", init, false) : window.attachEvent ? attachEvent(\"onload\", init) : (onload = init);\n  this.open = requestPage;\n  this.stop = abortReq;\n  this.rebuildLinks = init;\n  \n})();\n"]}